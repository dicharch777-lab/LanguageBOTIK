<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Language Bot</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: var(--tg-theme-bg-color, #f5f5f5);
            color: var(--tg-theme-text-color, #000);
            padding: 15px;
        }

        h2 {
            text-align: center;
        }

        .btn {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #fff);
            cursor: pointer;
        }

        input {
            width: 100%;
            padding: 10px;
            margin: 6px 0;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .card {
            background: #fff;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<h2>üìò Language Bot</h2>

<div id="menu">
    <button class="btn" onclick="openAdd()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ</button>
    <button class="btn" onclick="openWords()">üìö –ú–æ–∏ —Å–ª–æ–≤–∞</button>
    <button class="btn" onclick="startQuiz()">üéØ –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</button>
</div>

<!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
<div id="addForm" class="hidden">
    <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ</h3>
    <input id="word" placeholder="–°–ª–æ–≤–æ">
    <input id="translation" placeholder="–ü–µ—Ä–µ–≤–æ–¥">
    <input id="example" placeholder="–ü—Ä–∏–º–µ—Ä">
    <input id="pos" placeholder="–ß–∞—Å—Ç—å —Ä–µ—á–∏">
    <input id="lang" placeholder="–Ø–∑—ã–∫ (EN)">
    <input id="diff" placeholder="–°–ª–æ–∂–Ω–æ—Å—Ç—å (1-5)" type="number">

    <button class="btn" onclick="submitWord()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button class="btn" onclick="back()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<!-- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ª–æ–≤ -->
<div id="words" class="hidden">
    <h3>üìö –ú–æ–∏ —Å–ª–æ–≤–∞</h3>
    <div id="wordsList"></div>
    <button class="btn" onclick="back()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    function openAdd() {
        menu(false);
        document.getElementById("addForm").classList.remove("hidden");
    }

    function openWords() {
        menu(false);
        document.getElementById("words").classList.remove("hidden");
        tg.sendData("get_words"); // –∑–∞–ø—Ä–æ—Å —Å–ª–æ–≤ —É –±–æ—Ç–∞
    }

    function startQuiz() {
        tg.sendData("quiz");
        tg.close();
    }

    function submitWord() {
        const data = [
            word.value,
            translation.value,
            example.value,
            pos.value,
            lang.value,
            diff.value
        ].join(" - ");

        tg.sendData("add_word:" + data);
        tg.close();
    }

    function back() {
        menu(true);
        document.getElementById("addForm").classList.add("hidden");
        document.getElementById("words").classList.add("hidden");
    }

    function menu(show) {
        document.getElementById("menu").style.display = show ? "block" : "none";
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª–æ–≤ –æ—Ç –±–æ—Ç–∞
    tg.onEvent("message", (msg) => {
        if (!msg.data || !msg.data.startsWith("words:")) return;

        const words = JSON.parse(msg.data.replace("words:", ""));
        const container = document.getElementById("wordsList");
        container.innerHTML = "";

        words.forEach(w => {
            container.innerHTML += `
                <div class="card">
                    <b>${w.word}</b> ‚Äî ${w.translation}<br>
                    ${w.example ? "üìå " + w.example + "<br>" : ""}
                    ${w.part_of_speech || ""} | ${w.language} | ‚≠ê ${w.difficulty}
                </div>
            `;
        });
    });
</script>

</body>
</html>
